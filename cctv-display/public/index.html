<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Traffic AI Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="logo-area"><span class="icon">🚔</span><h1>Traffic AI Center</h1></div>
        <nav class="gnb">
            <ul>
                <li><a href="#" class="active">통합 관제</a></li>
                <li><a href="#" onclick="openInfoModal('dangerous')">⚠️ 위험차량</a></li>
                <li><a href="#" onclick="openInfoModal('vulnerable')">🚧 취약구간</a></li>
            </ul>
        </nav>
        <div class="status-area"><span id="current-time">00:00:00</span> <span class="system-status">● ONLINE</span></div>
    </header>

    <main class="dashboard-grid">
        <section class="cctv-section">
            <div class="card cctv-card">
                <div class="card-header">
                    <div class="selector-area">
                        <span class="label">📡 관제 지점:</span>
                        <input type="text" id="cctv-search" placeholder="검색 (예: 천안)" onkeyup="filterCCTV()">
                        <select id="cctv-selector" onchange="changeCCTV()"><option>로딩 중...</option></select>
                    </div>
                    <span class="badge live">LIVE FEED</span>
                </div>
                <div id="video-container" class="video-container"></div>
                <div class="ai-info">
                    <div class="info-item"><span class="label">AI 위험도 분석</span><span class="value safe" id="ai-risk">대기 중...</span></div>
                    <div class="info-item"><span class="label">AI 예측 속도 (1시간 후)</span><span class="value" id="ai-speed">-- km/h</span></div>
                </div>
            </div>
        </section>

        <section class="info-section">
            <div class="card map-card">
                <div class="card-header"><h3>🗺️ GIS 위치 관제</h3><div class="toggle-group"><label class="toggle-switch"><input type="checkbox" id="traffic-toggle" checked onchange="toggleLayer('traffic')"><span class="slider round" style="background:#ddd;"></span><span>🚦소통정보</span></label></div></div>
                <div id="map"></div>
            </div>
            <div class="card ai-insight-card">
                <div class="card-header" style="background: #2c3e50;"><h3 style="color:white;">🧠 AI 평소 패턴 분석</h3><span class="rec-dot" style="color:#00ff00; border-color:#00ff00;">● ANALYZING</span></div>
                <div class="insight-container" style="display: flex; flex-direction: column; justify-content: center; height: 100%; padding: 15px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1rem; color: #666; margin-bottom: 10px;">현재 시간대 평소 평균 속도</div>
                        <div style="display: flex; justify-content: center; align-items: baseline;">
                            <div id="disp-ai-normal" style="font-size: 3.5rem; font-weight: bold; color: #333; font-family: 'Orbitron';">--</div>
                            <div style="font-size: 1.2rem; margin-left: 5px; color: #555;">km/h</div>
                        </div>
                    </div>
                    <div id="analysis-result" style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                        <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">패턴 분석 중...</div>
                        <div style="font-size: 0.9rem; color: #666;">데이터를 불러오고 있습니다.</div>
                    </div>
                </div>
            </div>
        </section>
        
        <div class="bottom-section">
            <div class="card" style="flex: 1.2;">
                <div class="card-header"><h3>📈 AI 미래 교통 예보 (12시간)</h3><span class="badge" style="background:#0066ff;">PREDICTION</span></div>
                <div style="height: 100%; padding: 10px;"><canvas id="forecastChart"></canvas></div>
            </div>
            <div class="card" style="flex: 0.8; display: flex; flex-direction: column;">
                <div class="card-header" style="background: linear-gradient(45deg, #ff9966, #ff5e62);"><h3 style="color: white;">🚨 실시간 돌발/주의 정보</h3><span class="badge" style="background: #fff; color: #ff5e62;">LIVE INCIDENT</span></div>
                <div class="incident-list-container" style="flex: 1; padding: 10px; overflow-y: auto; background: #fff5f5;">
                    <ul id="incident-list" style="list-style: none; padding: 0; margin: 0;">
                        <li style="text-align: center; color: #888; padding: 20px;">데이터 로딩 중...</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <div id="infoModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">정보 조회</h3>
                <button onclick="closeInfoModal()" class="close-btn">✖</button>
            </div>
            <div class="modal-body">
                <table class="data-table">
                    <thead>
                        <tr id="modalTableHead">
                            </tr>
                    </thead>
                    <tbody id="modalTableBody">
                        <tr><td colspan="3">데이터를 불러오는 중입니다...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>